# Рефакторинг без страха

Страх рефакторинга обычно обоснован: неясная цель и слабые границы легко превращают улучшение структуры в поломку поведения.

Безопасный рефакторинг начинается не с кода, а с формализации инвариантов.

## Зафиксируйте цель и инварианты

До изменений определите:

- какое поведение должно остаться неизменным,
- какие интерфейсы трогать нельзя,
- какие метрики не должны ухудшиться,
- какие тесты подтверждают сохранение контракта.

Если это не записано, риск «тихой регрессии» высокий.

## Safety envelope для AI-рефакторинга

Задайте рамку:

- что входит в scope,
- что запрещено менять,
- допустимый размер диффа,
- обязательные проверки после каждого шага.

Рамка важнее «красоты» полученного кода.

## Поэтапный подход вместо big-bang

Просите у модели план из маленьких шагов:

1. изоляция повторов,
2. вынос функций,
3. упрощение зависимостей,
4. проверка после каждого шага.

Один большой diff сложнее ревьюить и откатывать.

## Антипаттерны

- запрос «просто сделай рефакторинг файла»;
- отсутствие baseline-тестов;
- одновременная смена структуры и поведения;
- отсутствие rollback-плана.

Итог главы:

**Безопасный рефакторинг — это серия малых проверяемых изменений в жёсткой рамке, а не «большая уборка за один раз».**

---

[Безопасный рефакторинг с ИИ](../ai_about_ai_ru/09_vibe_coding_refactor_without_fear.md) | [Refactor Without Fear](../ai_about_ai_short/09_vibe_coding_refactor_without_fear.md) |
