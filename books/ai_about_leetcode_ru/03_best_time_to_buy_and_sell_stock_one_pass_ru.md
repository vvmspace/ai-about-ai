# 03. Best Time to Buy and Sell Stock: одно прохождение, один минимум

В этой задаче многие сначала строят все пары «купи-продай», а потом считают максимум. Это честно, но слишком дорого: O(n²). Интервьюер ждёт, что вы увидите структуру: для каждого дня продажи нужен минимум цены слева.

Идея:
1. Держим минимальную цену, которую видели до текущего дня.
2. На каждом шаге считаем потенциальную прибыль `price - min_price`.
3. Обновляем лучший результат.

Инвариант: *к моменту i переменная `min_price` хранит минимум на префиксе `[0..i]`, а `best` — лучшую достижимую прибыль на том же префиксе*.

Сложность:
- время: **O(n)**;
- память: **O(1)**.

Неочевидные термины:
- **prefix minimum** — минимум на префиксе массива;
- **online algorithm** — алгоритм, который принимает решение в потоке, без полного знания будущего;
- **state compression** — храним только два числа вместо массивов DP.

Пример на Python:

```python
def max_profit(prices):
    min_price = float("inf")  # Минимум цены на уже просмотренном префиксе.
    best = 0  # Лучшая прибыль к текущему шагу.

    for price in prices:
        # Сначала обновляем минимум покупки.
        if price < min_price:
            min_price = price
            continue

        # Затем считаем прибыль, если продать сегодня.
        profit = price - min_price
        if profit > best:
            best = profit

    return best  # Если роста не было, вернётся 0.
```

Короткая проверка сложности в коде:
- один цикл без вложенности => O(n);
- фиксированное число переменных => O(1).

Интервью-ответ:

> “I treat it as a streaming optimisation problem: maintain the minimum historical buy price and compute the best sell profit at each step. The state is compressed to two scalars, giving linear time and constant space.”  
> [«Я рассматриваю задачу как потоковую оптимизацию: храню минимальную историческую цену покупки и на каждом шаге считаю лучшую прибыль от продажи. Состояние сжато до двух скаляров, поэтому получаем линейное время и константную память».]

Пара фраз:
- “Past minimum, present decision.”  
  [«Минимум в прошлом, решение в настоящем».]
- “No need for quadratic hindsight.”  
  [«Квадратичный перебор задним числом не нужен».]

Где это в работе: выбор лучшего окна для закупки ресурсов, анализ выгодного момента для запуска кампании, оценка лучшей точки конверсии на временном ряду метрик.

Полезные ссылки:
- [Best Time to Buy and Sell Stock на LeetCode](https://leetcode.com/problems/best-time-to-buy-and-sell-stock/)
- [Оглавление книги](./README.md)
