# AGENTS.md в агентных репозиториях: scope, приоритеты и контроль

Большинство команд узнаёт о `AGENTS.md` в худший момент:
когда агент уверенно редактирует не то, что нужно.

Любопытно, сколько «ошибок модели»
на самом деле являются ошибками инструкций.

Скажем прямо:
`AGENTS.md` — это не командная документация.
Это runtime-контроль.

## Что это за файл (и чем он не является)

В агентных workflow разработки `AGENTS.md`
задаёт локальные правила работы AI-агента.

Считайте, что это:

- слой инструкций с явным scope,
- который подгружается во время выполнения задачи,
- и ограничивает поведение в конкретном поддереве.

Это **не** заметка в wiki.
Это исполнимая governance-модель на обычном тексте.

Именно здесь начинается **AI agent governance**:
чёткие правила, повторяемые результаты и меньше инцидентов в проде.

## Ключевая механика: область действия директории

Файл управляет директорией, где лежит,
и всем, что находится ниже.

Это позволяет проектировать слои политики:

- корень репозитория: общие дефолты,
- папка подсистемы: доменные ограничения,
- папка фичи: узкие исключения.

Короткая версия:
локация = политика.

Если scope двусмысленный,
исполнение становится политикой в плохом смысле.
Люди спорят о намерениях вместо того, чтобы читать правило.

## Правила приоритета, которые реально важны

Надёжный стек обычно работает так:

1. system/developer/user-инструкции,
2. ближайший применимый `AGENTS.md`,
3. более общие родительские `AGENTS.md`,
4. дефолты агента.

Более вложенный файл перекрывает более широкий, если есть конфликт.

Это не «бухгалтерия для порядка».
Это граница между воспроизводимым результатом и хаосом.

Когда команды игнорируют этот порядок,
они часто диагностируют не ту проблему.
Обвиняют модель, хотя сбой начался в дизайне governance.

## Что писать внутри (минимально жизнеспособный контракт)

Сильный `AGENTS.md` с высоким сигналом должен задавать:

- **mission**: как выглядит успех в этой зоне,
- **boundaries**: что недопустимо ни при каких условиях,
- **workflow**: предпочтительный порядок действий,
- **validation**: точные проверки и команды,
- **delivery rules**: формат коммита/PR/отчёта,
- **escalation triggers**: когда остановиться и поднять риск.

Без «театра формулировок».
Только инструкции, меняющие поведение.

Если строка не может изменить решение агента,
её, вероятно, стоит удалить.

## Слабые и сильные формулировки

Слабо:
«Пожалуйста, поддерживайте чистый и хорошо протестированный код».

Сильно:

- запускай `pnpm test --filter api` после правок в `services/api/`,
- не редактируй сгенерированные файлы в `src/gen/`,
- если меняется схема, запусти проверку миграций и добавь вывод в PR.

Конкретика резко уменьшает пространство
для процессных галлюцинаций.

## Реальный паттерн сбоя: затенение инструкций

Частый инцидент:

- root-файл говорит «гони полный набор тестов»,
- вложенный файл говорит «только локальные тесты пакета»,
- но явного текста о замещении нет.

Итог: непоследовательность от задачи к задаче
и бесконечные разговоры «у меня же проходило».

Исправление:
явно прописывать намерение override.

Для исключения двусмысленности формулируйте как замену, а не пожелание:
«Правила этой папки заменяют root-требования по тестам для doc-only правок».

## Дизайн-паттерн: статус → граница → последствие

Пишите короткие управляющие строки:

- Статус: `docs/public/` — пользовательский контент.
- Граница: непроверяемые утверждения запрещены.
- Последствие: удаляем утверждение или блокируем коммит.

Спокойный тон.
Жёсткая граница.
Понятный исход.

## AGENTS.md как память об инцидентах

Когда происходит сбой,
обновляйте не только код,
но и инструкции.

Если инциденты не дают diff в правилах,
система не учится.
Она просто вежливо забывает.

Это прямой путь от «культуры постмортемов»
к *операционной памяти*.

## 20-минутный hardening-проход

Для одного активного репозитория:

1. нанесите на карту текущие слои инструкций,
2. уберите противоречивые команды,
3. добавьте явные override-заметки для вложенных scope,
4. замените расплывчатые фразы о качестве точными проверками,
5. добавьте один ясный escalation-trigger.

Затем прогоните три задачи и сравните объём переделок.

Большинство команд удивляется,
как быстро падает rework,
когда границы сформулированы точно.

`AGENTS.md` — это поверхность управления исполнением агента.

Относитесь к ней серьёзно,
и получите более предсказуемые прогоны,
более чистые handoff’ы
и меньше дорогих сюрпризов,
замаскированных под «ограничения интеллекта».

Если хотите продолжить, переходите к практическому разбору паттернов и анти-паттернов в [главе 27](./27_agentsmd_patterns_and_antipatterns.md).

Оригинал главы на английском: [AGENTS.md in Agentic Repos: Scope, Precedence, and Control](../ai_about_ai/26_agentsmd_as_execution_contract.md).
