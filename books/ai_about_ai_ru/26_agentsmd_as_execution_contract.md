# AGENTS.md в агентных репозиториях: область действия, приоритеты и контроль

Большинство команд узнаёт цену `AGENTS.md` в самый неподходящий момент:
когда агент уверенно редактирует не тот файл.

Любопытно, сколько «ошибок модели» на деле являются ошибками инструкций.

Скажем прямо:
`AGENTS.md` — это не командная документация.
Это контур runtime-контроля.

## Что это за файл (и чем он не является)

В агентных workflow разработки `AGENTS.md` задаёт локальные операционные правила для AI-агента.

Проще думать о нём так:

- это слой инструкций с чёткой областью действия,
- он подхватывается во время выполнения задачи,
- он ограничивает поведение в своей директории и ниже.

Это **не** заметка в wiki.
Это исполняемое управление в обычном тексте.

Именно здесь находится ядро **управления AI-агентами**:
чёткие правила, повторяемый результат и меньше инцидентов в проде.

## Ключевая механика: область директории

Файл управляет директорией, где расположен,
и всем поддеревом ниже.

Значит, можно строить слои политики:

- корень репозитория: базовые правила для всех,
- папка подсистемы: доменные ограничения,
- папка фичи: узкие исключения.

Коротко:
место файла и есть политика.

Если границы неочевидны, исполнение быстро становится политическим.
Команда спорит об «интенции», вместо того чтобы прочитать правило.

## Правила приоритета, которые действительно важны

Надёжный стек обычно работает так:

1. системные/developer/user инструкции,
2. ближайший применимый `AGENTS.md`,
3. более общие родительские `AGENTS.md`,
4. дефолты агента.

Более глубокий файл переопределяет более общий, если они конфликтуют.

Это не формальность для галочки.
Это разница между воспроизводимым результатом и хаосом.

Когда команды игнорируют этот порядок,
они часто диагностируют не ту проблему:
винят модель,
хотя сбой начался в дизайне governance.

## Что писать внутри (минимально жизнеспособный контракт)

Сильный `AGENTS.md` с высоким signal-to-noise должен фиксировать:

- **mission**: как выглядит успех в этой зоне,
- **boundaries**: что запрещено при любых условиях,
- **workflow**: предпочтительный порядок действий,
- **validation**: точные проверки и команды,
- **delivery rules**: формат коммита/PR/отчёта,
- **escalation triggers**: когда остановиться и поднять риск.

Без литературного театра.
Только инструкции, меняющие поведение.

Если строка не влияет на решение агента,
скорее всего, её стоит удалить.

## Слабая и сильная формулировка

Слабо:
«Пожалуйста, поддерживайте чистоту кода и покрытие тестами».

Сильно:

- после правок в `services/api/` запускать `pnpm test --filter api`,
- не редактировать сгенерированные файлы в `src/gen/`,
- при изменении схемы запускать migration-check и прикладывать вывод в PR.

Чем точнее правило,
тем меньше пространства для галлюцинаций процесса.

## Реальный паттерн сбоев: затенение инструкций

Частый инцидент:

- root-файл говорит «запускай полный тестовый набор»,
- вложенный файл говорит «только локальные тесты пакета»,
- явного текста о переопределении нет.

Результат: непоследовательное поведение между задачами
и бесконечные разговоры в стиле «у меня же проходило».

Исправление:
явно фиксировать намерение override.

Для исключения двусмысленности формулируйте это как замену, а не как совет:
«Правила в этой папке заменяют root-требования к тестам для doc-only правок».

## Рабочий паттерн: статус -> граница -> последствие

Пишите короткие линии контроля:

- Статус: `docs/public/` — клиентский контент.
- Граница: никаких непроверяемых утверждений.
- Последствие: удалить утверждение или блокировать коммит.

Спокойный тон.
Жёсткая рамка.
Ясный исход.

## AGENTS.md как память об инцидентах

Если произошёл сбой,
обновляйте не только код,
но и инструкции.

Если инциденты не рождают diff в правилах,
система не учится.
Она просто вежливо забывает.

Это практический переход
от «культуры постмортемов»
к *операционной памяти*.

## 20-минутный hardening-проход

Для одного активного репозитория:

1. отрисуйте текущие слои инструкций,
2. удалите противоречащие команды,
3. добавьте явные override-заметки для вложенных областей,
4. замените расплывчатые quality-строки точными проверками,
5. добавьте один прозрачный escalation-trigger.

После этого прогоните три реальные задачи и сравните объём переделок.

Большинство команд удивляется,
как быстро падает rework,
когда границы прописаны точно.

`AGENTS.md` — это поверхность управления исполнением агента.

Относитесь к ней всерьёз,
и вы получите более предсказуемые прогоны,
чище handoff,
и меньше дорогих сюрпризов,
которые маскируются под «пределы интеллекта».

Если хотите продолжить линию, переходите к материалу [AGENTS.md: паттерны и анти-паттерны для репозиториев](./27_agentsmd_patterns_and_antipatterns.md).

Английская версия этой главы: [AGENTS.md in Agentic Repos: Scope, Precedence, and Control](../ai_about_ai/26_agentsmd_as_execution_contract.md).
