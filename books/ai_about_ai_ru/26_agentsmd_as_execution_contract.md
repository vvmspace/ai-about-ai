# AGENTS.md как контракт исполнения

Большинство команд ошибается в одном и том же месте:
они воспринимают `AGENTS.md` как «памятку для новичков».

Агент воспринимает его иначе.
Как локальный закон.

Именно поэтому качество этого файла
определяет не стиль общения,
а вероятность инцидента.

## Почему это критично именно для агентных репозиториев

У человека есть контекст из созвонов,
личных договорённостей,
истории конфликтов в команде.

У агента этого нет.

У него есть:

- входные инструкции,
- доступные инструменты,
- файловая структура,
- текущая задача,
- и ваш `AGENTS.md`.

Если правила размыты,
он заполнит пробелы «вероятным» поведением.

Это и есть источник вежливых, дорогих ошибок.

## Что такое «контракт исполнения» на практике

Контракт исполнения — это не философия.
Это набор проверяемых обещаний:

- что агент обязан сделать,
- чего он делать не имеет права,
- как он доказывает качество,
- как он сообщает о риске.

Если обещание нельзя проверить,
это не контракт.
Это пожелание.

## Механика scope: где лежит файл, там и юрисдикция

`AGENTS.md` действует на папку,
где он расположен,
и на всё дерево ниже.

Отсюда вытекает архитектура:

- root-уровень задаёт общие правила,
- доменные папки уточняют локальные нормы,
- глубоко вложенные зоны фиксируют исключения.

Ключ:
не смешивайте уровни ответственности.

## Приоритеты: как не получить конфликт правил

Рабочая иерархия обычно выглядит так:

1. system/developer/user инструкции,
2. ближайший релевантный `AGENTS.md`,
3. родительские `AGENTS.md`,
4. дефолтное поведение агента.

Если не описать это явно,
команда будет спорить постфактум,
а не проектировать поведение заранее.

## Минимально достаточная структура файла

Сильный `AGENTS.md` закрывает шесть блоков:

1. **Миссия зоны** — что считается полезным результатом.
2. **Границы** — явный список запретов.
3. **Процесс** — порядок работы по шагам.
4. **Проверки** — точные команды и критерии pass/fail.
5. **Формат доставки** — commit/PR/final report.
6. **Эскалация** — когда агент должен остановиться.

Любой лишний абзац,
который не меняет поведение,
лучше удалить.

## Формулировка ограничений: статус -> граница -> последствие

Вместо мягких фраз используйте операционные конструкции.

Пример:

- Статус: `docs/public/` видит внешний клиент.
- Граница: без утверждений без источника.
- Последствие: удаление пункта или блокировка коммита.

Коротко.
Жёстко.
Проверяемо.

## Где команды чаще всего теряют управляемость

### 1) «Проверь качество» без команд

Агент не знает,
что у вас считается качеством.

### 2) Противоречивые требования в разных слоях

Root требует full test,
доменный слой разрешает smoke,
но override-правило не описано.

### 3) Нет no-touch зон

Generated-файлы,
миграции,
vendor-слепки
редактируются без контроля.

### 4) Нет явной политики при отказе инструментов

e2e упали,
и агент «тихо» идёт дальше,
будто ничего не произошло.

## Полезный шаблон для раздела «Проверки»

Указывайте всегда:

- команду,
- когда применять,
- что считать успехом,
- что делать при сбое.

Например:

- `pnpm test --filter api`
- для изменений в `services/api/**`
- успех: 0 failed tests
- сбой: остановка и отчёт с первыми 20 строками ошибки

Такой формат резко снижает импровизацию.

## AGENTS.md как память об инцидентах

После каждого серьёзного сбоя
должен обновляться не только код,
но и инструкция.

Если в ретро нет diff по `AGENTS.md`,
система не учится.

Она просто надеется.

## Быстрый 30-минутный апгрейд текущего файла

1. Удалите все «красивые», но непроверяемые фразы.
2. Добавьте 2 жёстких запрета.
3. Добавьте 2 обязательные проверки.
4. Обозначьте 1 no-touch зону.
5. Добавьте 1 триггер эскалации.

После этого прогоните три реальных задачи
и сравните объём доработок.

Обычно разница заметна в первую же неделю.

## Главная мысль

`AGENTS.md` — это не документация про процесс.
Это сам процесс,
записанный в исполняемой форме.

Чем яснее контракт,
тем спокойнее скорость.
