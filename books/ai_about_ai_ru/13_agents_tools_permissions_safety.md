# Инструменты, права и безопасная автономность

В тот момент, когда агент получает инструмент действия в мире,
он перестаёт быть просто интерфейсом чата и становится операционным актором.

На этом рубеже энтузиазм обязан встретиться с дисциплиной.

Потому что tool-enabled агент умеет быстро создавать ценность.
И так же быстро — ущерб.

## Безопасная автономность начинается с threat model

Перед выдачей инструмента задайте четыре вопроса:

1. Что это действие может изменить?
2. Какой наихудший реалистичный сценарий злоупотребления/сбоя?
3. Как быстро мы это обнаружим?
4. Как быстро мы остановим и восстановим процесс?

Если ответы неясны — к автономному исполнению не готовы.

## Принцип минимальных прав — в практическом виде

Least privilege любят цитировать, но редко внедряют полностью.

На практике это:

- read-only по умолчанию,
- узкий write-scope,
- токены с коротким TTL,
- раздельные креды по средам,
- явные allow-list для внешних действий.

Широкий write «**для гибкости**» — это отложенный инцидент.

## Разделяйте планирование и исполнение

Надёжный контур делит функции:

- **planner** (что делать),
- **policy layer** (разрешено ли),
- **executor** (делает действие),
- **auditor** (логирует и оценивает качество).

Если один компонент и решает, и исполняет без ограничений — риск резко растёт.

## Логи, которые помогают в постмортеме

Каждый tool-call должен фиксировать:

- кто инициатор,
- время,
- хеш входа,
- действие,
- policy-решение,
- статус результата.

Без policy-решений в логах постмортем превращается в гадание.

Изменяемые логи = недоверяемая система.

## Классы повышенного риска

- отправка писем/сообщений,
- платежные и биллинговые API,
- запись в БД,
- модификация файлов,
- внешние web-действия,
- управление идентичностями и доступом.

Их нельзя защищать так же, как summarization-кейсы.

## Human-in-the-loop на границе риска

Автономность должна быть условной.
Определите пороги обязательного согласования:

- денежный эффект,
- юридический эффект,
- необратимые клиентские действия,
- изменение прав доступа,
- массовые операции.

Люди не должны проверять всё.
Они должны проверять опасное.

## Полевой кейс: предотвращённый массовый mis-send

Команда customer ops дала агенту право на follow-up сообщения.
Правило было: отправлять при «*высокой уверенности*».

На шумных данных confidence остался высоким на устаревшем сегменте.
Потенциальную массовую ошибку остановил только лимит объёма, который требовал human-approval.

После инцидента добавили:

- контроль свежести сегмента,
- rate limits,
- двойное согласование массовых отправок.

Крупного ущерба не произошло.
Потому что один защитный контур уже был.

## Red-team тренировки обязательны

Ежемесячно проверяйте:

- prompt injection,
- вредоносные ссылки,
- паттерны exfiltration,
- попытки privilege escalation,
- небезопасные bulk-операции.

Если защита работает только на «<u>дружелюбных входах</u>», это не защита.

## Антипаттерны

### 1) Demo-права в проде
Прототипные разрешения перекочевали в боевую среду.

### 2) Общие API-ключи на всех
Нет персональной ответственности агентов.

### 3) Нет kill switch
Проблема видна, но мгновенно остановить нельзя.

### 4) Политика только в промпте
Критичные правила должны проверяться runtime-слоем, а не пожеланиями в тексте.

## Практика: аудит одного агента

Выберите одного агента с инструментами.

1. Перечислите все инструменты и scope прав.
2. Уберите одно необязательное разрешение.
3. Добавьте approval gate на одно рискованное действие.
4. Смоделируйте adversarial input.
5. Убедитесь, что логи позволяют полную реконструкцию.

Повторять ежемесячно.

## Почему безопасная автономность ускоряет, а не тормозит

Многие считают безопасность налогом на скорость.
Сильные команды видят обратное.

Когда границы явные, доставка ускоряется, тревожность падает, инцидентов меньше, доверия больше.

Безопасность — не трение.
Это операционная ясность.

Фраза для комнаты принятия решений:

**Автономность без исполнимых границ — не инновация, а неуправляемое обязательство.**
