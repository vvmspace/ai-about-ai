# Протоколы взаимодействия агент-агент

Когда два агента сотрудничают без протокола,
вы получаете не teamwork,
а вежливую энтропию.

Агентам легко звучать уверенно.
Редко получается чисто передавать ответственность.

## Модель рукопожатия

Любое межагентное взаимодействие должно проходить через handshake:

1. **Intent** — что нужно отправителю.
2. **Payload** — структурированный артефакт.
3. **Confidence** — калиброванная уверенность.
4. **Open risks** — незакрытые края и неопределённости.
5. **Expected action** — approve, transform или escalate.

Нет handshake — нет handoff.

На практике именно здесь *multi-agent systems*
либо масштабируются,
либо тихо ломаются.

## Правила дизайна сообщений

Держите сообщения в двойном формате:

- короткая сводка для человека,
- строгий машинный блок.

Сводка сохраняет скорость оператора.
Структурный блок сохраняет надёжность пайплайна.

Если писать только для людей,
автоматизация ломается.
Если писать только для машин,
надзор замедляется до ползания.

## Бюджет на уточнения

Скажем прямо:
«задавайте сколько угодно уточнений» убивает пропускную способность.

Дайте получателю лимит, например:

- до 3 вопросов,
- затем работа с явно зафиксированными assumptions,
- или эскалация, если обязательных полей не хватает.

Это предотвращает бесконечные циклы,
замаскированные под тщательность.

## Доверие вычисляется, а не предполагается

Назначайте каждому отправителю рейтинг надёжности на основе:

- соблюдения схемы,
- исторической частоты исправлений,
- качества доказательной базы,
- стабильности по latency.

После этого маршрутизируйте задачи по рейтингу.

High-risk задачи не должны зависеть
от low-reliability агентов,
каким бы элегантным ни был их текст.

## Протокол разрешения конфликтов

Агент A говорит «выпускаем».
Агент B говорит «блокируем».

В зрелой системе происходит следующее:

- сверка по рубрике,
- оценка силы доказательств,
- запуск tiebreak-агента или human-review,
- логирование решения и обоснования.

Без этого конфликты решают харизмой.
Это не governance.

## Сигналы наблюдаемости, которые действительно важны

Отслеживайте:

- долю отклонённых handoff’ов,
- число уточнений на задачу,
- плотность assumptions,
- частоту эскалаций,
- стоимость на принятый артефакт.

Если этих метрик нет,
оптимизация превращается в театр.

Этот стек метрик также улучшает операционные решения,
потому что протоколы можно настраивать по данным,
а не по мнениям.

## Практичная protocol card

Для следующего workflow определите:

- одну схему payload,
- одну рубрику confidence,
- один escalation-trigger,
- одно правило максимума повторов.

Прогоните 20 задач.
Потом проверьте,
где именно протокол предотвратил сбой.

Обычно всплывает неприятная правда:
узким местом был не «интеллект».
Узким местом была гигиена интерфейса.

## Чеклист оператора (быстрая версия)

До включения автономных циклов проверьте:

- обязательные поля схемы там, где это критично,
- метки confidence привязаны к явным порогам,
- владельцы эскалаций назначены,
- у повторов есть жёсткий потолок,
- логи сохраняют трассировку решений.

Если не хватает хотя бы одного пункта,
готовьтесь к двусмысленным сбоям.

Качество коллаборации агентов = качество протоколов.

Не количество агентов.
Не бренд модели.

Сначала протокол.
Потом производительность.

Для организационного дизайна поверх этих протоколов переходите к [главе 29](./29_agent_societies_roles_incentives_and_control.md).

Оригинал главы на английском: [Agent-to-Agent Interaction Protocols](../ai_about_ai/28_agent_to_agent_interaction_protocols.md).
