# Протоколы взаимодействия между агентами

Когда два агента сотрудничают без протокола,
вы получаете не командную работу,
а вежливую энтропию.

Говорить уверенно для агента легко.
Чисто передавать ответственность — редкость.

## Модель рукопожатия

Каждое межагентное взаимодействие требует handshake:

1. **Intent** — что именно нужно отправителю.
2. **Payload** — структурированный артефакт.
3. **Confidence** — калиброванный уровень уверенности.
4. **Open risks** — нерешённые края и риски.
5. **Expected action** — одобрить, трансформировать или эскалировать.

Нет handshake — нет handoff.

На практике именно здесь *многоагентные системы*
либо масштабируются,
либо тихо ломаются.

## Правила дизайна сообщений

Держите сообщения в двух форматах:

- короткое человеческое резюме,
- строгий машинный блок.

Резюме ускоряет оператора.
Структурный блок удерживает надёжность пайплайна.

Если писать только для людей,
автоматизация ломается.
Если писать только для машин,
контроль и надзор становятся слишком медленными.

## Бюджет на уточнения

Скажем прямо:
«задавайте бесконечно уточняющие вопросы» убивает throughput.

Дайте каждому получателю бюджет уточнений, например:

- до 3 вопросов,
- затем работа с явными assumptions,
- либо эскалация, если обязательные поля отсутствуют.

Так вы избегаете бесконечных циклов,
замаскированных под добросовестность.

## Доверие считается, а не предполагается

Назначайте каждому отправителю score надёжности по:

- соблюдению схемы,
- исторической доле исправлений,
- качеству доказательств,
- стабильности задержек.

Дальше маршрутизируйте задачи по этому score.

High-risk задачи не должны зависеть от low-reliability агентов,
как бы элегантно ни выглядел их текст.

## Протокол разрешения конфликтов

Агент A говорит «выпускать».
Агент B говорит «блокировать».

Вот как это должно работать в зрелой системе:

- сравнение по рубрике,
- оценка силы доказательств,
- tiebreak через отдельного агента или человека,
- лог решения и его rationale.

Без этого конфликты решаются харизмой.
Это не governance.

## Сигналы наблюдаемости, которые действительно важны

Отслеживайте:

- долю отклонённых handoff,
- число уточнений на задачу,
- плотность assumptions,
- частоту эскалаций,
- стоимость на принятый артефакт.

Если эти метрики невидимы,
оптимизация превращается в театр.

Этот стек метрик улучшает и операционные решения,
потому что протоколы настраиваются по данным,
а не по впечатлениям.

## Практическая protocol-card

Для ближайшего workflow определите:

- одну схему payload,
- одну рубрику confidence,
- один trigger эскалации,
- одно правило максимальных повторов.

Запустите 20 задач.
Потом проведите аудит,
где протокол реально предотвратил сбой.

Обычно всплывает неудобная правда:
узким местом был не «интеллект».
Узким местом была гигиена интерфейса.

## Чеклист оператора (быстрая версия)

Перед включением автономных циклов проверьте:

- обязательные поля схемы действительно обязательны,
- confidence-метки привязаны к явным порогам,
- владельцы эскалации назначены поимённо,
- у повторов есть жёсткий лимит,
- логи сохраняют трассировку решений.

Если не хватает хотя бы одного пункта,
готовьтесь к двусмысленным отказам.

Качество взаимодействия агентов — это качество протокола.

Не число агентов.
Не бренд модели.

Сначала протокол.
Затем производительность.

Для организационного дизайна поверх этих протоколов откройте материал [Сообщества агентов: роли, стимулы и контроль](./29_agent_societies_roles_incentives_and_control.md).

Английская версия этой главы: [Agent-to-Agent Interaction Protocols](../ai_about_ai/28_agent_to_agent_interaction_protocols.md).
